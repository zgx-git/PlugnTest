/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Gradle plugin project to get you started.
 * For more details take a look at the Writing Custom Plugins chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.6.1/userguide/custom_plugins.html
 */

plugins {
    // Apply the Java Gradle plugin development plugin to add support for developing Gradle plugins
    id 'java-gradle-plugin'
    // Apply the Groovy plugin to add support for Groovy
    id 'groovy'

    // 应用 Maven Publish Plugin 发布插件
    id 'maven-publish'

    id 'com.jfrog.bintray' version "1.8.5"
}

task sourcesJar(type: Jar, dependsOn: classes) {
    def classifier = getArchiveClassifier()
    classifier.set('sources')
    classifier.convention('sources')
    from sourceSets.main.allSource
}

// task javadocJar(type: Jar, dependsOn: javadoc) {
//     def classifier = getArchiveClassifier()
//     classifier.set('javadoc')
//     classifier.convention('javadoc')
//     from javadoc.destinationDir
// }
//
// tasks.withType(Javadoc) {
//     options.addStringOption('Xdoclint:none', '-quiet')
//     options.addStringOption('encoding', 'UTF-8')
//     options.addStringOption('charSet', 'UTF-8')
// }

publishing {
    publications {
        apkRename(MavenPublication) {
            // 组件类型，我们的插件其实就是Java组件
            from components.java
            // 插件的组ID，建议设置为插件的包名
            groupId = 'com.lenebf.plugin'
            // 翻译过来是 工件ID，我的理解是插件的名字
            artifactId = 'apk-rename'
            version = '0.0.6'
            artifact sourcesJar
            // artifact javadocJar
        }
    }

    repositories {
        maven {
            // $rootProject 表示你项目的根目录
            url = "../repo"
        }
    }
}

bintray {
    user = System.getenv('BINTRAY_USER')
    key = System.getenv('BINTRAY_KEY')
    publications = ['apkRename']
    pkg {
        // 必填项，前面我们创建的仓库名称
        repo = 'maven'

        // 必填项，我们要上传的包的名称
        name = 'apk_rename'
        // 每次上传直接发布
        publish = true

        // 开原许可，如果是开源包必须有，否则可选
        // 文档原话：your package licenses (mandatory if the package doesn't exist yet and must be created,
        // and if the package is an OSS package; optional otherwise)
        licenses = ['Apache-2.0']

        // 版本控制系统地址（一般为git地址）如果是开源包必须有，否则可选
        // 文档原话：your VCS URL (mandatory if the package doesn't exist yet and must be created,
        // and if the package is an OSS package; optional otherwise)
        vcsUrl = 'https://github.com/lenebf/GradlePluginTutorial'

        // 包的版本信息
        version {
            // 必填，版本名称
            name = '0.0.6'
            // 选填，版本描述
            desc = 'ApkRename Plugin 0.0.6'
            // 选填，版本发布日期
            released = new Date()
            // 选填，版本控制系统的对象的tag名称
            vcsTag = 'tag_0.0.6'
            // 选填，该版本的附件属性信息，可以任意填写
            attributes = ['apk-rename': 'a simple plugin.']
        }
    }
}

gradlePlugin {
    // Define the plugin
    plugins {
        apkRename {
            id = 'com.lenebf.plugin.apk-rename'
            implementationClass = 'com.lenebf.plugin.ApkRenamePlugin'
        }
    }
}
repositories {
    google()
    jcenter()
}
dependencies {
    implementation 'com.android.tools.build:gradle:4.1.3'
}
